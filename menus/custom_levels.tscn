[gd_scene load_steps=5 format=3 uid="uid://c3746gmhgb8n"]

[sub_resource type="GDScript" id="GDScript_dnww3"]
script/source = "extends Button

@export var file_dialog : FileDialog


func _on_button_up():
	file_dialog.popup(Rect2(0, 0, 1000, 500))
	
"

[sub_resource type="GDScript" id="GDScript_c727j"]
script/source = "extends Button

@export var line_edit : LineEdit
@export var level_starter : Node

func _on_button_up():
	level_starter.start_level_from_url(line_edit.text)
"

[sub_resource type="GDScript" id="GDScript_tm04a"]
script/source = "extends FileDialog

@export var level_starter : Node

func _ready():
	add_filter(\"*.tscn\", \"Godot Scenes or EOLevels\")

func _on_file_selected(path):
	print(path)
	level_starter.start_level_from_path(path)
"

[sub_resource type="GDScript" id="GDScript_mrnkb"]
script/source = "extends Node

@export var httprequest : HTTPRequest

var tempfilepath = ProjectSettings.globalize_path(\"user://level_loaded_from_the_internet_lmao.tscn\")

func start_level_from_path(path : String):
	get_tree().change_scene_to_file(path)

func start_level_from_string(string : String):
	var tempfile = FileAccess.open(tempfilepath, FileAccess.WRITE)
	if(!tempfile):
		push_warning(\"You good bro? The file path \\\"\" + tempfilepath + \"\\\" didnt seem to work.\")
		return
	tempfile.store_string(string)
	tempfile.close()
	start_level_from_path(tempfilepath)

func start_level_from_url(url : String):
	httprequest.request(url)

func _on_http_request_request_completed(result, response_code, headers, body):
	start_level_from_string(body.get_string_from_utf8())
"

[node name="Control" type="Control"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="from_file" type="Button" parent="." node_paths=PackedStringArray("file_dialog")]
layout_mode = 0
offset_left = 450.0
offset_top = 146.0
offset_right = 714.0
offset_bottom = 221.0
text = "Load level from file."
script = SubResource("GDScript_dnww3")
file_dialog = NodePath("../stuff/FileDialog")

[node name="from_url" type="Button" parent="." node_paths=PackedStringArray("line_edit", "level_starter")]
layout_mode = 0
offset_left = 853.0
offset_top = 251.0
offset_right = 1021.0
offset_bottom = 326.0
text = "Load level from URL."
script = SubResource("GDScript_c727j")
line_edit = NodePath("LineEdit")
level_starter = NodePath("../stuff/LevelStarter")

[node name="LineEdit" type="LineEdit" parent="from_url"]
layout_mode = 0
offset_left = -526.0
offset_right = -17.0
offset_bottom = 75.0
placeholder_text = "URL here"

[node name="Label" type="Label" parent="."]
layout_mode = 0
offset_left = 475.0
offset_top = 65.0
offset_right = 691.0
offset_bottom = 91.0
text = "Custom Levels :snowsmiley:"

[node name="stuff" type="Node" parent="."]

[node name="FileDialog" type="FileDialog" parent="stuff" node_paths=PackedStringArray("level_starter")]
title = "Open a File"
initial_position = 2
size = Vector2i(392, 162)
ok_button_text = "Open"
file_mode = 0
access = 2
script = SubResource("GDScript_tm04a")
level_starter = NodePath("../LevelStarter")

[node name="HTTPRequest" type="HTTPRequest" parent="stuff"]

[node name="LevelStarter" type="Node" parent="stuff" node_paths=PackedStringArray("httprequest")]
script = SubResource("GDScript_mrnkb")
httprequest = NodePath("../HTTPRequest")

[connection signal="button_up" from="from_file" to="from_file" method="_on_button_up"]
[connection signal="button_up" from="from_url" to="from_url" method="_on_button_up"]
[connection signal="file_selected" from="stuff/FileDialog" to="stuff/FileDialog" method="_on_file_selected"]
[connection signal="request_completed" from="stuff/HTTPRequest" to="stuff/LevelStarter" method="_on_http_request_request_completed"]
